<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UrbanDriveStore ‚Äî Beli Robux & Gamepass CDID Aman & Cepat</title>
  <meta name="description" content="UrbanDriveStore - beli Robux & Gamepass CDID. Marketplace prototype: katalog, keranjang, filter, checkout via WhatsApp." />
  <meta property="og:title" content="UrbanDriveStore ‚Äî Beli Robux & Gamepass CDID" />
  <meta property="og:description" content="Promo harian, pengiriman cepat, panduan Gamepass. Checkout via WhatsApp." />
  <meta property="og:image" content="/assets/uds-og.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#070707;--card:#121212;--muted:#9aa0a6;--accent:#ffcc00;--accent-2:#ff8a00;--glass: rgba(255,255,255,0.03);--success:#22c55e}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,var(--bg),#050505);color:#fff}
    a{color:inherit}
    header{position:sticky;top:0;z-index:40;background:linear-gradient(90deg,#0b0b0b, rgba(255,204,0,0.03));backdrop-filter: blur(4px);border-bottom:1px solid rgba(255,255,255,0.03)}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{height:44px;width:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#000;font-weight:700}
    .brand h1{font-size:18px;margin:0;color:var(--accent);letter-spacing:0.4px}
    .search{flex:1;margin-left:18px}
    .search input{width:100%;padding:10px 14px;border-radius:10px;border:none;background:var(--glass);color:#fff}
    .actions{display:flex;align-items:center;gap:10px}
    .icon-btn{background:var(--card);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}

    /* HERO */
    .hero{padding:36px 0;background:linear-gradient(180deg,rgba(255,204,0,0.02),transparent)}
    .hero-grid{display:grid;grid-template-columns:1fr 360px;gap:24px;align-items:center}
    .hero-title{font-size:28px;margin-bottom:10px;color:var(--accent)}
    .hero-sub{color:var(--muted);margin-bottom:18px}
    .cta-row{display:flex;gap:12px}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:12px 16px;border-radius:10px;color:#000;font-weight:700;border:none;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:10px;color:var(--muted);cursor:pointer}

    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .stat{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;min-width:110px;text-align:center}
    .stat strong{display:block;color:var(--accent);font-size:18px}
    .stat small{color:var(--muted)}

    /* LAYOUT */
    main{padding:14px 0 80px}
    .main-grid{display:grid;grid-template-columns:260px 1fr;gap:20px}

    /* SIDEBAR */
    .sidebar{position:sticky;top:86px;background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .filters h3{margin:0 0 10px 0;color:var(--accent)}
    .category-list{display:flex;flex-direction:column;gap:8px}
    .category{padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .category.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#000;font-weight:600}
    .range{margin-top:12px}

    /* PRODUCTS */
    .catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .product{background:var(--card);border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column}
    .product .thumb{height:140px;background-size:cover;background-position:center}
    .product .body{padding:12px;flex:1;display:flex;flex-direction:column}
    .product h4{margin:0 0 6px 0;color:var(--accent);font-size:15px}
    .product p{margin:0 0 8px 0;color:var(--muted);font-size:13px}
    .price-row{display:flex;justify-content:space-between;align-items:center;margin-top:auto}
    .price{font-weight:700}
    .add{background:var(--accent);padding:8px 10px;border-radius:8px;color:#000;border:none;cursor:pointer}

    /* CART */
    .cart-bar{position:fixed;right:18px;bottom:18px;background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:12px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5);z-index:100}
    .cart-count{background:#000;color:var(--accent);padding:6px 8px;border-radius:8px;font-weight:700;margin-left:8px}

    /* CART SIDEBAR */
    .cart-sidebar{position:fixed;right:18px;top:86px;width:360px;max-height:72vh;background:#0e0e0e;border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);overflow:auto;box-shadow:0 10px 30px rgba(0,0,0,0.6);display:none;z-index:120}
    .cart-item{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
    .cart-item img{width:64px;height:48px;object-fit:cover;border-radius:8px}
    .cart-actions{display:flex;gap:8px;align-items:center;margin-top:12px}
    .checkout-btn{flex:1;background:var(--accent);border:none;padding:10px;border-radius:8px;color:#000;font-weight:700;cursor:pointer}
    .clear-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}

    /* MODAL */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:200}
    .modal{background:#121212;padding:20px;border-radius:12px;max-width:720px;width:95%;max-height:86vh;overflow:auto}
    .modal .row{display:flex;gap:16px}
    .modal .thumb{flex:0 0 260px;height:180px;background-size:cover;border-radius:10px}
    .modal .info{flex:1}
    .modal h3{margin-top:0;color:var(--accent)}

    /* MOBILE FILTER */
    .mobile-filter-btn{display:none;position:fixed;left:18px;bottom:18px;z-index:110;background:var(--card);border-radius:12px;padding:10px;border:1px solid rgba(255,255,255,0.03)}
    .filter-drawer{position:fixed;left:0;right:0;bottom:0;background:#0e0e0e;padding:16px;border-radius:12px 12px 0 0;display:none;z-index:210}

    /* TESTIMONIAL */
    .testi{margin-top:28px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:16px;border-radius:12px}
    .slider{display:flex;gap:12px;overflow:hidden}
    .slide{min-width:100%;transition:transform 0.4s ease}

    /* FOOTER */
    footer{padding:36px 0;margin-top:30px;color:var(--muted);text-align:center}

    /* RESPONSIVE */
    @media(max-width:900px){.hero-grid{grid-template-columns:1fr}.main-grid{grid-template-columns:1fr}.sidebar{display:none}.cart-sidebar{right:12px;left:12px;width:auto}.container{padding:12px}.mobile-filter-btn{display:block}}
  

.checkout-modal {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:200;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
  from {opacity:0;}
  to {opacity:1;}
}
.checkout-content {
  background:#fff; color:#000; padding:25px; border-radius:12px; width:90%; max-width:420px;
  box-shadow:0 6px 20px rgba(0,0,0,0.4); transform: translateY(-30px); opacity:0;
  animation: slideUp 0.4s ease forwards;
}
@keyframes slideUp {
  to {transform: translateY(0); opacity:1;}
}
.checkout-content h2 { margin-bottom:20px; text-align:center; font-size:1.4rem; color:#333; }
.checkout-content label { display:block; margin-top:12px; font-weight:600; font-size:0.9rem; color:#444; }
.checkout-content input, .checkout-content select, .checkout-content textarea {
  width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #ccc; font-size:14px;
  transition:border-color 0.2s ease, box-shadow 0.2s ease;
}
.checkout-content input:focus, .checkout-content select:focus, .checkout-content textarea:focus {
  border-color:#ffcc00; box-shadow:0 0 4px rgba(255,204,0,0.6); outline:none;
}
.checkout-content textarea { resize:vertical; min-height:70px; }
.checkout-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:20px; }
.checkout-actions button {
  padding:9px 16px; border:none; border-radius:8px; cursor:pointer; font-weight:600; font-size:0.9rem;
  transition: background 0.2s ease, transform 0.2s ease;
}
.checkout-actions button:hover { transform: translateY(-1px); }
#checkoutCancel { background:#ccc; color:#333; }
#checkoutCancel:hover { background:#bbb; }
#checkoutSubmit { background:#ffcc00; color:#000; }
#checkoutSubmit:hover { background:#e6b800; }
.error-msg { color:red; font-size:0.8rem; margin-top:4px; display:none; }

#checkoutCancel { background:#ccc; }
#checkoutSubmit { background:#ffcc00; }

</style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true">UD</div>
        <div>
          <h1>UrbanDriveStore</h1>
          <div style="font-size:12px;color:var(--muted)">Robux & Gamepass CDID ‚Äî Aman & Cepat</div>
        </div>
      </div>

      <div class="search">
        <input id="searchInput" aria-label="Cari produk" placeholder="Cari produk, misal: Robux, Luxury Car, 50 Robux..." />
      </div>

      <div class="actions">
        <button class="icon-btn" id="btnWishlist" title="Wishlist" aria-label="Wishlist">‚ù§</button>
        <button class="icon-btn" id="btnCartSmall" title="Keranjang" aria-label="Buka keranjang">üõí <span id="cartBadge" style="margin-left:6px;color:var(--accent)">0</span></button>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container hero-grid">
      <div>
        <div class="hero-title">Lebih Cepat, Lebih Aman ‚Äî Dapatkan Robux & Gamepass CDID</div>
        <div class="hero-sub">Promo harian, pengiriman cepat, dan panduan pembuatan Gamepass. Pilih produk, tambahkan ke keranjang, dan checkout lewat WhatsApp.</div>
        <div class="cta-row">
          <button class="btn-primary" id="btnShopNow">Mulai Belanja</button>
          <button class="btn-ghost" id="btnHow" aria-haspopup="dialog">Cara Order</button>
        </div>

        <div class="stats">
          <div class="stat"><strong>+5.000</strong><small>Transaksi</small></div>
          <div class="stat"><strong>4.9 ‚òÖ</strong><small>Rating Customer</small></div>
          <div class="stat"><strong>24/7</strong><small>Support</small></div>
        </div>
      </div>

      <div style="background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
          <div style="width:64px;height:64px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:12px"></div>
          <div>
            <div style="color:var(--accent);font-weight:700">Promo Hari Ini</div>
            <div style="color:var(--muted);font-size:13px">Diskon khusus untuk pembelian gamepass</div>
          </div>
        </div>
        <div style="font-size:13px;color:var(--muted)">Masukkan username & nomor WA saat checkout. Kita akan konfirmasi via WhatsApp.</div>
      </div>
    </div>
  </section>

  <main class="container">
    <div class="main-grid">
      <aside class="sidebar" id="sidebar">
        <div class="filters">
          <h3>Filter</h3>
          <div style="margin-bottom:8px;color:var(--muted);font-size:13px">Kategori</div>
          <div class="category-list" id="categoryList"></div>

          <div class="range">
            <div style="margin-top:12px;color:var(--muted);font-size:13px">Harga (maks)</div>
            <input type="range" id="priceRange" min="0" max="100000" step="1000" value="100000" />
            <div style="font-size:13px;color:var(--muted);margin-top:6px">Rp <span id="priceRangeVal">100000</span></div>
          </div>
        </div>

        <div style="margin-top:18px">
          <h3>Tips Cepat</h3>
          <ul style="color:var(--muted);font-size:13px"> 
            <li>Buat Gamepass di Roblox sesuai panduan.</li>
            <li>Gunakan metode pembayaran QRIS atau GoPay.</li>
            <li>Chat WA jika ada kendala.</li>
          </ul>
        </div>
      </aside>

      <section>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="color:var(--muted);font-size:14px">Menampilkan <span id="productCount">0</span> produk</div>
          <div style="display:flex;gap:8px;align-items:center">
            <select id="sortSelect" style="background:var(--card);border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.03);color:var(--muted)">
              <option value="relevance">Terbaru</option>
              <option value="price_asc">Harga terendah</option>
              <option value="price_desc">Harga tertinggi</option>
            </select>
          </div>
        </div>

        <div class="catalog" id="catalog" aria-live="polite"></div>

        <div class="testi" id="testimonials">
          <h3 style="margin:0 0 8px 0;color:var(--accent)">Testimoni</h3>
          <div class="slider" id="slider">
            <div class="slide">‚ÄúPengiriman cepat, layanan ramah ‚Äî recommended!‚Äù ‚Äî Rizky</div>
            <div class="slide">‚ÄúHarga bersaing, prosesnya mudah.‚Äù ‚Äî Siti</div>
            <div class="slide">‚ÄúPanduan gamepass sangat membantu.‚Äù ‚Äî Ardi</div>
          </div>
        </div>

      </section>
    </div>
  </main>

  <button class="mobile-filter-btn icon-btn" id="openFilter" aria-haspopup="dialog">Filter</button>
  <div class="filter-drawer" id="filterDrawer" role="dialog" aria-modal="true" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong style="color:var(--accent)">Filter</strong>
      <button class="icon-btn" id="closeFilter">‚úï</button>
    </div>
    <div style="color:var(--muted);margin-bottom:8px">Kategori</div>
    <div id="mobileCategoryList"></div>
    <div style="margin-top:12px;color:var(--muted);font-size:13px">Harga (maks)</div>
    <input type="range" id="priceRangeMobile" min="0" max="100000" step="1000" value="100000" />
    <div style="font-size:13px;color:var(--muted);margin-top:6px">Rp <span id="priceRangeValMobile">100000</span></div>
    <div style="margin-top:12px;display:flex;gap:8px"><button class="btn-primary" id="applyFilterMobile">Terapkan</button><button class="btn-ghost" id="resetFilterMobile">Reset</button></div>
  </div>

  <div class="cart-bar" id="cartBar" role="button" aria-label="Buka keranjang">
    <div style="display:flex;align-items:center;gap:10px">
      <div style="font-weight:700">Keranjang</div>
      <div class="cart-count" id="cartCount">0</div>
    </div>
  </div>

  <aside class="cart-sidebar" id="cartSidebar" aria-hidden="true">
    <h3 style="margin-top:0;color:var(--accent)">Keranjang Anda</h3>
    <div id="cartItems"></div>
    <div style="margin-top:12px;display:flex;align-items:center;justify-content:space-between">
      <div style="color:var(--muted)">Total</div>
      <div style="font-weight:700" id="cartTotal">Rp0</div>
    </div>
    <div class="cart-actions">
      <button class="checkout-btn" id="btnCheckout">Checkout via WhatsApp</button>
      <button class="clear-btn" id="btnClearCart">Kosongkan</button>
    </div>
  </aside>

  <!-- Modal product detail -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 id="modalTitle">Produk</h3>
        <button class="icon-btn" id="closeModal">‚úï</button>
      </div>
      <div class="row">
        <div class="thumb" id="modalThumb" role="img" aria-label="Gambar produk"></div>
        <div class="info">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <h3 id="modalName"></h3>
              <div id="modalCategory" style="color:var(--muted);font-size:13px"></div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:700" id="modalPrice">Rp0</div>
              <div style="font-size:12px;color:var(--muted)">belum termasuk biaya admin</div>
            </div>
          </div>

          <p id="modalDesc" style="color:var(--muted);margin-top:12px"></p>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <label for="modalQuantity" style="font-size:13px;color:var(--muted)">Jumlah</label>
            <input id="modalQuantity" type="number" min="1" value="1" style="width:80px;padding:8px;border-radius:8px;border:none;background:#2a2a2a;color:#fff" />
            <button class="add" id="modalAdd">Tambah ke Keranjang</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div style="display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap">
        <div>
          <div style="color:var(--accent);font-weight:700">UrbanDriveStore</div>
          <div style="color:var(--muted);font-size:13px">Contact: 0851-8328-3404 (WhatsApp)</div>
        </div>
        <div style="color:var(--muted);font-size:13px">¬© 2025 UrbanDriveStore. All rights reserved.</div>
      </div>
    </div>
  </footer>

  

<script>
(function(){
  const PRODUCTS = [
    {id:1,name:'Luxury Car',price:36260,category:'Gamepass',img:'/assets/luxury-car.jpg',alt:'Luxury Car',desc:'Gamepass membuka mobil mewah di CDID.'},
    {id:2,name:'Rare Imports',price:26460,category:'Gamepass',img:'/assets/rare-imports.jpg',alt:'Rare Imports',desc:'Akses ke mobil impor langka dan eksklusif.'},
    {id:3,name:'Retro Car',price:23660,category:'Gamepass',img:'/assets/retro-car.jpg',alt:'Retro Car',desc:'Koleksi mobil retro klasik yang unik.'},
    {id:4,name:'Emergency Vehicle',price:19460,category:'Gamepass',img:'/assets/ambulance.jpg',alt:'Emergency Vehicle',desc:'Akses kendaraan darurat eksklusif.'},
    {id:5,name:'Additional Ownable Car',price:13860,category:'Gamepass',img:'/assets/car-key.jpg',alt:'Additional car slot',desc:'Slot mobil tambahan +1.'},
    {id:6,name:'2x Additional Ownable Car',price:37660,category:'Gamepass',img:'/assets/car-key.jpg',alt:'2 additional car slots',desc:'Dua slot mobil tambahan (+2).'},
    {id:7,name:'Paycheck Booster (2x)',price:55860,category:'Gamepass',img:'/assets/money.jpg',alt:'Double Paycheck',desc:'Dapatkan gaji dua kali lipat.'},
    {id:8,name:'+50% Job Earning',price:55860,category:'Gamepass',img:'/assets/money.jpg',alt:'+50% Job Earning',desc:'Pendapatan kerja meningkat +50%.'},
    {id:9,name:'Luxury House',price:11060,category:'Gamepass',img:'/assets/luxury-house.jpg',alt:'Luxury House',desc:'Akses ke rumah mewah eksklusif.'},
    {id:10,name:'Advanced Modification',price:34860,category:'Gamepass',img:'/assets/tuning.jpg',alt:'Advanced Modification',desc:'Opsi modifikasi lanjutan untuk kendaraan.'}
  ,
  { id: 11, name: '50 Robux', price: 7000, category: 'Robux', desc: 'Pembelian 50 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 12, name: '100 Robux', price: 14000, category: 'Robux', desc: 'Pembelian 100 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 13, name: '150 Robux', price: 21000, category: 'Robux', desc: 'Pembelian 150 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 14, name: '200 Robux', price: 28000, category: 'Robux', desc: 'Pembelian 200 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 15, name: '250 Robux', price: 35000, category: 'Robux', desc: 'Pembelian 250 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 16, name: '300 Robux', price: 42000, category: 'Robux', desc: 'Pembelian 300 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 17, name: '350 Robux', price: 49000, category: 'Robux', desc: 'Pembelian 350 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 18, name: '400 Robux', price: 56000, category: 'Robux', desc: 'Pembelian 400 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
  { id: 19, name: '450 Robux', price: 63000, category: 'Robux', desc: 'Pembelian 450 Robux.' , img: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'}
];

  const CART_KEY = 'uds_cart_v1';
  let state = { cat: 'All', maxPrice: 100000, query: '', sort: 'relevance', cart: [] };

  const $ = s => document.querySelector(s);
  const catalog = $('#catalog');
  const productCount = $('#productCount');
  const categoryList = $('#categoryList');
  const priceRange = $('#priceRange');
  const priceRangeVal = $('#priceRangeVal');
  const searchInput = $('#searchInput');
  const cartCount = $('#cartCount');
  const cartSidebar = $('#cartSidebar');
  const cartItemsEl = $('#cartItems');
  const cartTotalEl = $('#cartTotal');
  const cartBar = $('#cartBar');
  const cartBadge = $('#cartBadge');
  const modalOverlay = $('#modalOverlay');
  const modalTitle = $('#modalTitle');
  const modalThumb = $('#modalThumb');
  const modalName = $('#modalName');
  const modalPrice = $('#modalPrice');
  const modalDesc = $('#modalDesc');
  const modalCategory = $('#modalCategory');
  const modalQuantity = $('#modalQuantity');
  const modalAdd = $('#modalAdd');
  const closeModalBtn = $('#closeModal');
  const mobileFilterBtn = $('#openFilter');
  const filterDrawer = $('#filterDrawer');
  const closeFilter = $('#closeFilter');
  const mobileCategoryList = $('#mobileCategoryList');
  const priceRangeMobile = $('#priceRangeMobile');
  const priceRangeValMobile = $('#priceRangeValMobile');
  const applyFilterMobile = $('#applyFilterMobile');
  const resetFilterMobile = $('#resetFilterMobile');
  const sortSelect = $('#sortSelect');
  const btnShopNow = $('#btnShopNow');
  const btnHow = $('#btnHow');
  const btnCartSmall = $('#btnCartSmall');
  const btnClearCart = $('#btnClearCart');
  const btnCheckout = $('#btnCheckout');

  try { const saved = localStorage.getItem(CART_KEY); state.cart = saved ? JSON.parse(saved) : []; } catch(e){ state.cart = []; }

  function saveCart(){ try{ localStorage.setItem(CART_KEY, JSON.stringify(state.cart)); }catch(e){} }
  function debounce(fn, ms=300){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(this,a), ms); }; }
  function sumQty(){ return state.cart.reduce((s,c)=>s + (c.qty||0), 0); }

  function renderCategories(){
    if(!categoryList) return;
    const cats = ['All', ...Array.from(new Set(PRODUCTS.map(p=>p.category)))];
    categoryList.innerHTML = '';
    if(mobileCategoryList) mobileCategoryList.innerHTML = '';
    cats.forEach(c=>{
      const el = document.createElement('div');
      el.className = 'category' + (state.cat===c ? ' active' : '');
      el.tabIndex = 0; el.textContent = c;
      el.addEventListener('click', ()=>{ state.cat = c; document.querySelectorAll('.category').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderCatalog(); });
      categoryList.appendChild(el);
      if(mobileCategoryList){
        const mel = el.cloneNode(true);
        mel.addEventListener('click', ()=>{ state.cat = c; closeFilterDrawer(); renderCatalog(); });
        mobileCategoryList.appendChild(mel);
      }
    });
  }

  function renderCatalog(){
    if(!catalog) return;
    let items = PRODUCTS.slice();
    items = items.filter(p => p.price <= (state.maxPrice || 99999999));
    if(state.cat && state.cat !== 'All') items = items.filter(p => p.category === state.cat);
    if(state.query){ const q = state.query.toLowerCase(); items = items.filter(p => (p.name + ' ' + (p.desc||'') + ' ' + (p.category||'')).toLowerCase().includes(q)); }
    if(state.sort === 'price_asc') items.sort((a,b)=>a.price-b.price);
    if(state.sort === 'price_desc') items.sort((a,b)=>b.price-a.price);

    catalog.innerHTML = '';
    items.forEach(p=>{
      const card = document.createElement('div'); card.className = 'product';
      const thumb = document.createElement('div'); thumb.className='thumb';
      if(p.img){ thumb.style.backgroundImage = `url('${p.img}')`; } else { thumb.style.background = 'linear-gradient(135deg,#ffcc00,#ff8a00)'; thumb.textContent='üöó'; thumb.style.display='flex'; thumb.style.alignItems='center'; thumb.style.justifyContent='center'; thumb.style.fontSize='32px'; }
      card.appendChild(thumb);

      const body = document.createElement('div'); body.className = 'body';
      const h4 = document.createElement('h4'); h4.textContent = p.name; body.appendChild(h4);
      const pEl = document.createElement('p'); pEl.textContent = p.desc || ''; body.appendChild(pEl);
      const priceRow = document.createElement('div'); priceRow.className = 'price-row';
      const price = document.createElement('div'); price.className='price'; price.textContent = 'Rp' + p.price.toLocaleString('id-ID');
      const addWrap = document.createElement('div');
      const btn = document.createElement('button'); btn.className='add'; btn.textContent='Tambah'; btn.setAttribute('data-id', p.id);
      btn.addEventListener('click', ()=> openModal(p));
      addWrap.appendChild(btn);
      priceRow.appendChild(price); priceRow.appendChild(addWrap);
      body.appendChild(priceRow);
      card.appendChild(body);
      catalog.appendChild(card);
    });
    if(productCount) productCount.textContent = items.length;
  }

  let currentModalProduct = null;
  function openModal(product){
    if(!modalOverlay) return;
    currentModalProduct = product;
    if(modalTitle) modalTitle.textContent = product.name;
    if(modalThumb){ if(product.img) modalThumb.style.backgroundImage = `url('${product.img}')`; else { modalThumb.style.background = 'linear-gradient(135deg,#ffcc00,#ff8a00)'; modalThumb.textContent='üöó'; } modalThumb.setAttribute('aria-label', product.alt || product.name); }
    if(modalName) modalName.textContent = product.name;
    if(modalPrice) modalPrice.textContent = 'Rp' + product.price.toLocaleString('id-ID');
    if(modalDesc) modalDesc.textContent = product.desc || '';
    if(modalCategory) modalCategory.textContent = product.category || '';
    if(modalQuantity) modalQuantity.value = 1;
    modalOverlay.style.display = 'flex';
  }
  function closeModal(){ if(modalOverlay) modalOverlay.style.display = 'none'; currentModalProduct = null; }

  function renderCart(){
    if(!cartItemsEl) return;
    cartItemsEl.innerHTML = '';
    if(!state.cart || state.cart.length === 0){ cartItemsEl.innerHTML = '<div style="color:var(--muted);padding:12px">Keranjang kosong</div>'; }
    state.cart.forEach(item => {
      const p = PRODUCTS.find(x=>x.id === item.id);
      if(!p) return;
      const el = document.createElement('div'); el.className = 'cart-item';
      const imgSrc = p.img ? p.img : '/assets/fallback.jpg';
      el.innerHTML = '<img src="' + imgSrc + '" alt="' + (p.alt||'') + '" onerror="this.src=\'/assets/fallback.jpg\'"/>' +
                     '<div style="flex:1"><div style="font-weight:700">' + p.name + '</div><div style="color:var(--muted);font-size:13px">Rp' + p.price.toLocaleString('id-ID') + ' x ' + item.qty + '</div></div>' +
                     '<div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end"><button class="icon-btn" data-action="inc" data-id="' + item.id + '" aria-label="Tambah jumlah">+</button><button class="icon-btn" data-action="dec" data-id="' + item.id + '" aria-label="Kurangi jumlah">-</button></div>';
      cartItemsEl.appendChild(el);
    });
    cartItemsEl.querySelectorAll('button').forEach(btn=>{ btn.addEventListener('click', ()=>{ const id = Number(btn.getAttribute('data-id')); const action = btn.getAttribute('data-action'); if(action==='inc') changeQty(id,1); else changeQty(id,-1); }); });
    const total = state.cart.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + (p ? p.price * i.qty : 0); }, 0);
    if(cartTotalEl) cartTotalEl.textContent = 'Rp' + total.toLocaleString('id-ID');
    const qtySum = sumQty();
    if(cartCount) cartCount.textContent = qtySum;
    if(cartBadge) cartBadge.textContent = qtySum;
    saveCart();
  }

  function changeQty(id,delta){ const idx = state.cart.findIndex(c=>c.id === id); if(idx === -1) return; state.cart[idx].qty += delta; if(state.cart[idx].qty <= 0) state.cart.splice(idx,1); renderCart(); }
  function addToCart(product, qty=1){ const exists = state.cart.find(c=>c.id === product.id); if(exists) exists.qty += qty; else state.cart.push({ id: product.id, qty }); renderCart(); closeModal(); showFeedback('Berhasil ditambahkan'); }

  function checkoutWhatsApp(){
    if(!state.cart || state.cart.length === 0){ alert('Keranjang kosong.'); return; }
    const wa='6285183283404'; let message = 'Halo UrbanDriveStore.\nSaya ingin order via website.\n\n'; let total=0;
    state.cart.forEach(i=>{ const p = PRODUCTS.find(x=>x.id===i.id); message += '- ' + p.name + ' x' + i.qty + ' : Rp' + (p.price*i.qty).toLocaleString('id-ID') + '\n'; total += p.price*i.qty; });
    message += '\nTotal: Rp' + total.toLocaleString('id-ID') + '\n\nUsername Roblox: [isi username]\nNomor WA: [isi nomor]\nAlamat/Notes: [opsional]';
    const url = 'https://wa.me/' + wa + '?text=' + encodeURIComponent(message); window.open(url,'_blank');
  }

  function toggleCart(){ if(!cartSidebar) return; if(cartSidebar.style.display === 'block'){ cartSidebar.style.display = 'none'; cartSidebar.setAttribute('aria-hidden','true'); } else { cartSidebar.style.display = 'block'; cartSidebar.setAttribute('aria-hidden','false'); } }
  function clearCart(){ if(confirm('Kosongkan keranjang?')){ state.cart = []; renderCart(); } }
  function showFeedback(msg){ const el = document.createElement('div'); el.style.position='fixed'; el.style.right='18px'; el.style.bottom='90px'; el.style.background='var(--success)'; el.style.color='#000'; el.style.padding='10px 14px'; el.style.borderRadius='10px'; el.style.fontWeight='700'; el.textContent = msg; document.body.appendChild(el); setTimeout(()=>el.remove(),1400); }

  function startTestimonialSlider(){ const slider = $('#slider'); if(!slider) return; let idx=0; setInterval(()=>{ idx=(idx+1)%slider.children.length; slider.style.transform = 'translateX(-' + (idx*100) + '%)'; }, 3500); }
  function openFilterDrawer(){ if(!filterDrawer) return; filterDrawer.style.display='block'; filterDrawer.setAttribute('aria-hidden','false'); }
  function closeFilterDrawer(){ if(!filterDrawer) return; filterDrawer.style.display='none'; filterDrawer.setAttribute('aria-hidden','true'); }
  function showHow(){ const msg = 'Cara Order:\n1) Pilih produk.\n2) Tambah ke keranjang.\n3) Checkout via WhatsApp.\nPastikan kirim username & nomor WA yang benar.'; alert(msg); }

  function bindUI(){
    if(priceRange) priceRange.addEventListener('input', ()=>{ state.maxPrice = Number(priceRange.value); if(priceRangeVal) priceRangeVal.textContent = priceRange.value; renderCatalog(); });
    if(priceRangeMobile) priceRangeMobile.addEventListener('input', ()=>{ if(priceRangeValMobile) priceRangeValMobile.textContent = priceRangeMobile.value; });
    if(searchInput) searchInput.addEventListener('input', debounce((e)=>{ state.query = e.target.value.toLowerCase(); renderCatalog(); }, 300));
    if(btnShopNow) btnShopNow.addEventListener('click', ()=>{ const el = document.querySelector('.catalog'); if(el) window.scrollTo({ top: el.offsetTop - 80, behavior: 'smooth' }); });
    if(btnHow) btnHow.addEventListener('click', showHow);
    if(btnCartSmall) btnCartSmall.addEventListener('click', toggleCart);
    if(cartBar) cartBar.addEventListener('click', toggleCart);
    if(btnClearCart) btnClearCart.addEventListener('click', clearCart);
    if(btnCheckout) btnCheckout.addEventListener('click', checkoutWhatsApp);
    if(sortSelect) sortSelect.addEventListener('change', (e)=>{ state.sort = e.target.value; renderCatalog(); });
    if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
    if(modalAdd) modalAdd.addEventListener('click', ()=>{ if(currentModalProduct) addToCart(currentModalProduct, Number(modalQuantity.value || 1)); });
    window.addEventListener('click', (e)=>{ if(e.target === modalOverlay) closeModal(); });
    if(mobileFilterBtn) mobileFilterBtn.addEventListener('click', openFilterDrawer);
    if(closeFilter) closeFilter.addEventListener('click', closeFilter);
    if(applyFilterMobile) applyFilterMobile.addEventListener('click', ()=>{ state.maxPrice = Number(priceRangeMobile.value); if(priceRange) priceRange.value = priceRangeMobile.value; if(priceRangeVal) priceRangeVal.textContent = priceRangeMobile.value; closeFilterDrawer(); renderCatalog(); });
    if(resetFilterMobile) resetFilterMobile.addEventListener('click', ()=>{ if(priceRangeMobile) priceRangeMobile.value = 100000; if(priceRangeValMobile) priceRangeValMobile.textContent = '100000'; });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ closeModal(); closeFilterDrawer(); } });
  }

  function init(){ renderCategories(); renderCatalog(); bindUI(); renderCart(); startTestimonialSlider(); }
  init();

  window._UDS = { PRODUCTS, state, renderCatalog, renderCart, addToCart, openModal };
})();
</script>



<!-- Checkout Modal -->
<div id="checkoutModal" class="checkout-modal">
  <div class="checkout-content">
    <h2>Form Checkout</h2>
    <label>Username Roblox <span style="color:red">*</span></label>
    <input type="text" id="checkoutUsername" placeholder="Masukkan username Roblox" required><span class='error-msg' id='errUsername'>Harap isi Username Roblox</span>
    
    <label>Nomor WhatsApp <span style="color:red">*</span></label>
    <input type="tel" id="checkoutPhone" placeholder="08xxxxxxxxxx" required><span class='error-msg' id='errPhone'>Harap isi Nomor WhatsApp</span>
    
    <label>Metode Pembayaran <span style="color:red">*</span></label>
    <select id="checkoutPayment" required><span class='error-msg' id='errPayment'>Harap pilih metode pembayaran</span>
      <option value="">-- Pilih Metode Pembayaran --</option>
      <option value="Dana">Dana</option>
      <option value="OVO">OVO</option>
      <option value="GoPay">GoPay</option>
      <option value="Bank Transfer">Bank Transfer</option>
    </select>
    
    <label>Catatan</label>
    <textarea id="checkoutNote" placeholder="Catatan tambahan (opsional)"></textarea>
    
    <div class="checkout-actions">
        <div id="checkoutTotals" style="margin-top:15px; font-size:0.9rem; background:#f9f9f9; padding:10px; border-radius:8px;">
            <div>Subtotal: <span id="subtotalDisplay">Rp0</span></div>
            <div>Biaya Admin: <span id="adminFeeDisplay">Rp0</span></div>
            <div><strong>Total: <span id="totalDisplay">Rp0</span></strong></div>
        </div>
        
      <button id="checkoutCancel">Batal</button>
      <button id="checkoutSubmit">Kirim</button>
    </div>
  </div>
</div>

<script>
document.querySelectorAll('#checkoutButton').forEach(btn => {
  btn.addEventListener('click', function(e){
    e.preventDefault();
    openCheckoutForm();
  });
});
</script>

<script>
(function(){
  const checkoutModal = document.getElementById('checkoutModal');
  const checkoutCancel = document.getElementById('checkoutCancel');
  const checkoutSubmit = document.getElementById('checkoutSubmit');

  function openCheckoutForm(){
    if(checkoutModal) checkoutModal.style.display = 'flex';
  }
  function closeCheckoutForm(){
    if(checkoutModal) checkoutModal.style.display = 'none';
  }

  // Replace old checkout button to remove previous listeners and attach new one
  const old = document.getElementById('btnCheckout');
  if(old && old.parentNode){
    const clone = old.cloneNode(true);
    old.parentNode.replaceChild(clone, old);
    clone.addEventListener('click', function(e){
      e.preventDefault();
      openCheckoutForm();
    });
  }

  // Also handle any other buttons that may trigger checkout (by class checkout-btn)
  document.querySelectorAll('.checkout-btn').forEach(btn => {
    btn.addEventListener('click', function(e){
      e.preventDefault();
      openCheckoutForm();
    });
  });

  // Cancel button
  if(checkoutCancel) checkoutCancel.addEventListener('click', function(){ closeCheckoutForm(); });

  // click outside modal closes it
  window.addEventListener('click', function(e){
    if(e.target === checkoutModal){
      closeCheckoutForm();
    }
  });

  // Submit handler
  if(checkoutSubmit){
    checkoutSubmit.addEventListener('click', function(){
      const username = (document.getElementById('checkoutUsername')||{}).value || '';
      const phone = (document.getElementById('checkoutPhone')||{}).value || '';
      const payment = (document.getElementById('checkoutPayment')||{}).value || '';
      const note = (document.getElementById('checkoutNote')||{}).value || '';

      // reset errors
      document.querySelectorAll('.error-msg').forEach(e=>e.style.display='none');
      let valid = true;
      if(!username.trim()){ const el = document.getElementById('errUsername'); if(el) el.style.display='block'; valid=false; }
      if(!phone.trim()){ const el = document.getElementById('errPhone'); if(el) el.style.display='block'; valid=false; }
      if(!payment.trim()){ const el = document.getElementById('errPayment'); if(el) el.style.display='block'; valid=false; }

      // Ensure cart non-empty
      const uds = window._UDS || {};
      const cart = (uds.state && uds.state.cart) ? uds.state.cart : [];
      if(!valid) return;
      if(!cart || cart.length === 0){ alert('Keranjang kosong.'); closeCheckoutForm(); return; }

      let orderText = 'Pesanan dari UrbanDriveStore:%0A';
      orderText += 'Username Roblox: ' + username + '%0A';
      orderText += 'Nomor WA: ' + phone + '%0A';
      orderText += 'Metode Pembayaran: ' + payment + '%0A';
      if(note && note.trim()) orderText += 'Catatan: ' + note + '%0A';
      orderText += '%0AOrder:%0A';

      let totalPrice = 0;
      const PRODUCTS = uds.PRODUCTS || [];
      cart.forEach(i=>{
        const p = PRODUCTS.find(x=>x.id===i.id);
        if(!p) return;
        const subtotal = (p.price || 0) * (i.qty || 0);
        totalPrice += subtotal;
        orderText += (i.qty || 0) + 'x ' + p.name + ' ‚Äî Rp' + subtotal.toLocaleString('id-ID') + '%0A';
      });
      orderText += '%0ATotal: Rp' + totalPrice.toLocaleString('id-ID');

      // send to seller WA
      const seller = '6285183283404';
      const waUrl = 'https://wa.me/' + seller + '?text=' + orderText;
      window.open(waUrl, '_blank');
      closeCheckoutForm();
    });
  }
})();
</script>


<script>
function updateCheckoutTotals(){
    let subtotal = 0;
    cart.forEach(item=>{
        const p = PRODUCTS.find(x=>x.id === item.id);
        if(p) subtotal += p.price * item.qty;
    });
    let payment = document.getElementById('checkoutPayment').value;
    let adminFee = 0;
    if(['QRIS','Dana','OVO','GoPay'].includes(payment)) adminFee = 1000;
    else if(payment === 'Mandiri') adminFee = 2500;
    
    document.getElementById('subtotalDisplay').textContent = 'Rp' + subtotal.toLocaleString('id-ID');
    document.getElementById('adminFeeDisplay').textContent = 'Rp' + adminFee.toLocaleString('id-ID');
    document.getElementById('totalDisplay').textContent = 'Rp' + (subtotal+adminFee).toLocaleString('id-ID');
    return {subtotal, adminFee, total: subtotal+adminFee};
}

document.getElementById('checkoutPayment').addEventListener('change', updateCheckoutTotals);
document.addEventListener('DOMContentLoaded', updateCheckoutTotals);

// Override submit checkout
document.getElementById('checkoutSubmit').addEventListener('click', function(){
    const username = document.getElementById('checkoutUsername').value.trim();
    const phone = document.getElementById('checkoutPhone').value.trim();
    const payment = document.getElementById('checkoutPayment').value.trim();
    const note = document.getElementById('checkoutNote').value.trim();
    
    document.querySelectorAll('.error-msg').forEach(e => e.style.display = 'none');
    let valid = true;
    if(!username){ document.getElementById('errUsername').style.display = 'block'; valid = false; }
    if(!phone){ document.getElementById('errPhone').style.display = 'block'; valid = false; }
    if(!payment){ document.getElementById('errPayment').style.display = 'block'; valid = false; }
    if(!valid) return;
    
    const totals = updateCheckoutTotals();
    
    let orderText = 'Pesanan dari UrbanDriveStore:%0A';
    orderText += 'Username Roblox: ' + username + '%0A';
    orderText += 'Nomor WA: ' + phone + '%0A';
    orderText += 'Metode Pembayaran: ' + payment + '%0A';
    if(note) orderText += 'Catatan: ' + note + '%0A';
    orderText += '%0AOrder:%0A';
    
    cart.forEach(item=>{
        const p = PRODUCTS.find(x=>x.id === item.id);
        if(p){
            const subtotal = p.price * item.qty;
            orderText += item.qty + 'x ' + p.name + ' ‚Äî Rp' + subtotal.toLocaleString('id-ID') + '%0A';
        }
    });
    
    orderText += '%0ASubtotal: Rp' + totals.subtotal.toLocaleString('id-ID');
    orderText += '%0ABiaya Admin (' + payment + '): Rp' + totals.adminFee.toLocaleString('id-ID');
    orderText += '%0ATotal: Rp' + totals.total.toLocaleString('id-ID');
    
    const waUrl = 'https://wa.me/62' + phone.replace(/^0/, '') + '?text=' + orderText;
    window.open(waUrl, '_blank');
    closeCheckoutForm();
});
</script>
</body>
</html>
